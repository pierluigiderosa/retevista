{% extends "base.html" %}
{% load static %}
{% load leaflet_tags %}
{% load l10n %}

{% block script %}
    {% leaflet_js %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.7.2/dist/Chart.bundle.min.js"></script>
{% endblock %}
{% block css %}
    {% leaflet_css %}
    <style>
        .leaflet-container { height: 600px; width: 100%}
    </style>
{% endblock %}


{% block content %}

    <div class="row">
        {% include "lateral_panel_dashboard.html" %}

        <div class="col-md-4 p-0 bg-indigo h-md-100" url-endpoint='{% url "api-data-dash" %}'>
            <canvas id="myChart" width="400" height="200"></canvas>

            <h1>Operazioni per coltura</h1>

        </div>

        <div class="col-md-4 p-0 bg-white h-md-100">
            {% leaflet_map "main" callback="main_map_init" %}
        </div>
    </div>
    <script type="text/javascript">
        function main_map_init (map, options) {
            // Use Leaflet API here

        }
        var endpoint = "{% url 'api-data-dash' %}"

        $.ajax({
            method: "GET",
            url: endpoint,
            success: function (data) {
                labels = data.labels;
                defaultData = data.default;
                setChart()
            },
            error: function (error_data) {
                console.log("error")
                console.log(error_data)

            }
        });
        function setChart() {
            var ctx = document.getElementById('myChart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'coltura',
                        data: defaultData,
                        backgroundColor: 'rgb(54, 162, 235)',
                        borderColor: 'rgb(54, 162, 235)',
                        borderWidth: 1,
                        fill : false
                    },]
                },
                options: {
                    title: {
                        display: true,
                        text: 'Superficie per coltura',
                        fontSize: 18
                    },
                    scales: {
                        xAxes: [{
                            barPercentage: 0.5,
                            barThickness: 6,
                            maxBarThickness: 15,
                            minBarLength: 2,
                            gridLines: {
                                offsetGridLines: true
                            }
                        }]
                    }

                }
            });
        }

    </script>


{% endblock %}


{% block extrastyle %}

{% endblock %}